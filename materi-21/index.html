<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Materi 21: Workflow 2 - Membuat Laporan</title>
    <link rel="stylesheet" href="../assets/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container">
      <div id="sidebar-placeholder"></div>

      <button id="sidebar-toggle" title="Tutup Sidebar">&laquo;</button>

      <main class="content">
        <article>
          <h1>Materi 21: Workflow 2 - Membuat Laporan (Workflow Utama)</h1>
          <p class="intro">
            Ini adalah workflow utama dari sistem kita. Di sini, kita akan
            menggabungkan data dari berbagai sumber (API & Airtable), mengubah
            data tersebut, membuat file laporan (JSON & CSV), dan mengirim
            notifikasi via Email dan Discord.
          </p>
          <p>
            Untuk mempermudah, kita akan membagi pembangunan workflow ini menjadi
            <strong>3 Bagian</strong>.
          </p>

          <h2>Bagian 1: Mengambil & Menggabungkan Data</h2>
          <p>
            Tujuan bagian ini adalah menarik data penjualan dari ERP (via HTTP
            Request) dan data pelanggan dari Airtable (yang sudah kita perkaya di
            Workflow 1), lalu menggabungkannya.
          </p>

          <h3>Langkah-langkah:</h3>
          <ol>
            <li>
              <strong>HTTP Request Node:</strong> Ambil data dari API Perusahaan.
              <ul>
                <li>Method: <strong>GET</strong></li>
                <li>URL: Gunakan <strong>Dataset URL</strong> dari email Level 2 Anda.</li>
                <li>Authentication: <strong>Generic Credential Type</strong> > <strong>Header Auth</strong>.</li>
                <li>Credential: Buat baru, gunakan <strong>Header Auth Name & Value</strong> dari email Anda.</li>
                <li><strong>Send Headers:</strong> Aktifkan (Toggle ON).</li>
                <li>Header Name: <code>unique_id</code> | Value: Unique ID Anda dari email.</li>
              </ul>
            </li>
            <li>
              <strong>Airtable Node:</strong> Ambil data pelanggan.
              <ul>
                 <li>Table: <strong><code>customers</code></strong> (tabel yang kita update di Workflow 1).</li>
                 <li>Operation: <strong>List</strong>.</li>
              </ul>
            </li>
            <li>
              <strong>Merge Node:</strong> Gabungkan kedua sumber.
              <ul>
                 <li>Mode: <strong>Combine</strong> > <strong>Merge By Fields</strong>.</li>
                 <li>Field Input 1 & 2: <code>customerID</code>.</li>
              </ul>
            </li>
            <li>
              <strong>Sort Node:</strong> Urutkan data.
              <ul>
                 <li>Field: <code>orderPrice</code></li>
                 <li>Order: <strong>Descending</strong> (Terbesar ke terkecil).</li>
              </ul>
            </li>
          </ol>

          <h3>Kode Workflow Bagian 1 (JSON)</h3>
          <details class="solution-box">
            <summary>üìÑ Klik untuk menyalin JSON Bagian 1</summary>
            <div class="solution-content">
              <pre><code>
{
  "nodes": [
    {
      "parameters": {},
      "id": "53c8dcdd-83a6-4a3c-ac03-d3ee3d49ec32",
      "name": "When clicking \"Execute workflow\"",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [ -1152, 240 ]
    },
    {
      "parameters": {
        "url": "https://internal.users.n8n.cloud/webhook/level2-erp",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            { "name": "api_key", "value": "j[vKYdY68H(:WFb" },
            { "name": "unique_id", "value": "ee139a3c81d52b9da914fd46f413acf2" }
          ]
        },
        "options": {}
      },
      "id": "cbf33d5c-1dfb-41bd-ab5e-dc7779829aba",
      "name": "HTTP Request",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [ -928, 144 ],
      "credentials": {
        "httpHeaderAuth": { "id": "N248dgARXFPjXLRA", "name": "Header Auth account" }
      }
    },
    {
      "parameters": {
        "operation": "search",
        "base": { "__rl": true, "value": "appzgiK89L202rUE3", "mode": "list", "cachedResultName": "Beginner Course", "cachedResultUrl": "https://airtable.com/appzgiK89L202rUE3" },
        "table": { "__rl": true, "value": "tblmECBN2BZsUHNjX", "mode": "list", "cachedResultName": "customers", "cachedResultUrl": "https://airtable.com/appzgiK89L202rUE3/tblmECBN2BZsUHNjX" },
        "options": {}
      },
      "id": "f975e689-5270-4c01-9197-8941bdd52074",
      "name": "Airtable",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2,
      "position": [ -928, 336 ],
      "credentials": {
        "airtableTokenApi": { "id": "xwKF32ZJ0C3iAfpA", "name": "Airtable Personal Access Token account" }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "mergeByFields": { "values": [ { "field1": "customerID", "field2": "customerID" } ] },
        "options": {}
      },
      "id": "6a528401-b843-4bd4-abc8-761a3da4f444",
      "name": "Merge",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2.1,
      "position": [ -704, 240 ]
    },
    {
      "parameters": {
        "sortFieldsUi": { "sortField": [ { "fieldName": "orderPrice", "order": "descending" } ] },
        "options": {}
      },
      "id": "01cc4cd4-3c1b-40fc-a47e-7fcd7bc2583e",
      "name": "Sort",
      "type": "n8n-nodes-base.sort",
      "typeVersion": 1,
      "position": [ -480, 240 ]
    }
  ],
  "connections": {
    "When clicking \"Execute workflow\"": { "main": [ [ { "node": "HTTP Request", "type": "main", "index": 0 }, { "node": "Airtable", "type": "main", "index": 0 } ] ] },
    "HTTP Request": { "main": [ [ { "node": "Merge", "type": "main", "index": 0 } ] ] },
    "Airtable": { "main": [ [ { "node": "Merge", "type": "main", "index": 1 } ] ] },
    "Merge": { "main": [ [ { "node": "Sort", "type": "main", "index": 0 } ] ] },
    "Sort": { "main": [ [] ] }
  },
  "pinData": {},
  "meta": { "templateCredsSetupCompleted": true, "instanceId": "a612ce3732177191df67c49cdd165a9944332142dec2e0997de31bff5658a964" }
}
              </code></pre>
              <div class="note alt">
                <strong>‚ö†Ô∏è PENTING: Update Kredensial</strong><br />
                Kode di atas menggunakan kredensial akun saya. Jangan lupa untuk mengganti credential <strong>HTTP Request</strong> dan <strong>Airtable</strong> dengan milik Anda sendiri setelah melakukan paste.
              </div>
            </div>
          </details>

          <div class="image-wrapper">
            <img src="../assets/images/materi-21-get-and-merge-datas.png" alt="Flow Bagian 1" loading="lazy" />
            <p class="image-caption">Flow Bagian 1: Mengambil & Menggabungkan Data</p>
          </div>

          <h3>Kuis Bagian 1</h3>
          <details class="solution-box">
            <summary>‚ùì Siapa nama karyawan yang menangani pelanggan 1?</summary>
            <div class="solution-content">
              <p>
                Cek output JSON di Merge Node untuk Customer ID 1. Lihat kolom
                <code>employeeName</code>.
              </p>
            </div>
          </details>
          <details class="solution-box">
            <summary>‚ùì Berapa harga pesanan tertinggi?</summary>
            <div class="solution-content">
              <p>
                Karena kita mengurutkan secara Descending, cukup lihat
                <strong>Item ke-1</strong> di output Sort Node. Lihat nilai
                <code>orderPrice</code>.
              </p>
            </div>
          </details>

          <h2>Bagian 2: Laporan Penjualan Regional (JSON)</h2>
          <p>
            Kita ingin memfilter hanya pesanan dari wilayah "Americas" dan
            mengirimkannya sebagai file JSON individu via Email.
          </p>

          <div class="note alt">
            <strong>üìß Masalah: Tidak ada tombol "Sign in with Google"?</strong><br />
            Jika Anda menggunakan n8n Self-Hosted, ikuti langkah ini di Google Cloud Console:
            <ol style="margin-top: 10px; margin-bottom: 0;">
                <li>Buat Project baru & Aktifkan <strong>Gmail API</strong> di menu Library.</li>
                <li>Masuk ke menu <strong>Credentials</strong>.</li>
                <li>Klik <strong>Create Credentials</strong> > pilih <strong>OAuth client ID</strong>.</li>
                <li>Jika diminta "Configure Consent Screen":
                    <ul style="margin-top:5px; margin-bottom:5px;">
                        <li>Pilih <strong>External</strong> > Isi <strong>App Name</strong> & <strong>Email</strong>.</li>
                        <li><strong>WAJIB:</strong> Tambahkan email Gmail Anda di bagian <strong>Test Users</strong>.</li>
                    </ul>
                </li>
                <li>Pilih Application Type: <strong>Web application</strong>.</li>
                <li>
                  Di <strong>Authorized redirect URIs</strong>, salin URL dari n8n Anda:<br>
                  <code>https://[DOMAIN_ANDA]/rest/oauth2-credential/callback</code>
                </li>
                <li>Klik Create, lalu salin <strong>Client ID</strong> & <strong>Client Secret</strong> ke n8n.</li>
            </ol>
          </div>

          <h3>Langkah-langkah:</h3>
          <ol>
            <li>
              <strong>IF Node:</strong> Filter data.
              <ul>
                <li>Condition: <code>region</code> Equal to <code>Americas</code>.</li>
              </ul>
            </li>
            <li>
              <strong>Convert to File Node:</strong> Buat file biner.
              <ul>
                <li>Operation: <strong>Convert to JSON</strong>.</li>
                <li>Mode: <strong>Each Item</strong> (Satu file per pesanan).</li>
                <li>File Name: <code>report_orderID_{{ $json.orderID }}.json</code></li>
              </ul>
            </li>
            <li>
              <strong>Gmail Node:</strong> Kirim email.
              <ul>
                <li>Resource: <strong>Message</strong> > <strong>Send</strong>.</li>
                <li>To: Alamat email Anda sendiri.</li>
                <li>Subject: "Laporan Regional".</li>
                <li><strong>Attachments:</strong> Aktifkan, dan isi <code>Property Name</code> dengan <code>data</code>.</li>
              </ul>
            </li>
            <li>
              <strong>Discord Node:</strong> Notifikasi ke channel n8n.
              <ul>
                <li>Webhook URL: Gunakan URL dari email Level 2 Anda.</li>
                <li>Text: <code>I sent the file using email with the label ID {{ $json.labelIds[0] }}. My ID: [ID_ANDA]</code></li>
              </ul>
            </li>
          </ol>

          <h3>Kode Workflow Bagian 2 (JSON)</h3>
          <p>Salin kode ini. <strong>Hubungkan Input node "If" ke Output node "Sort"</strong> dari Bagian 1.</p>
          <details class="solution-box">
            <summary>üìÑ Klik untuk menyalin JSON Bagian 2</summary>
            <div class="solution-content">
              <pre><code>
{
  "nodes": [
    {
      "parameters": {
        "sendTo": "naufal97nabila@gmail.com",
        "subject": "Your TPS Reports",
        "emailType": "text",
        "message": "Please find your TPS report attached.",
        "options": { "attachmentsUi": { "attachmentsBinary": [ {} ] } }
      },
      "id": "9ca84fac-9c5d-4f08-9579-5cf9398460aa",
      "name": "Gmail",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [ 176, 144 ],
      "webhookId": "8c60abc3-e84e-4acb-9731-ea9b0852253f",
      "credentials": {
        "gmailOAuth2": { "id": "OLkxnVcb9kIyGtYs", "name": "Gmail account" }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict", "version": 1 },
          "conditions": [
            {
              "id": "d3afe65c-7c80-4caa-9d1c-33c62fbc2197",
              "leftValue": "={{ $json.region }}",
              "rightValue": "Americas",
              "operator": { "type": "string", "operation": "equals", "name": "filter.operator.equals" }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "b1021137-70fc-4a48-b04b-482ad56c2200",
      "name": "If",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [ -272, 144 ]
    },
    {
      "parameters": {
        "operation": "toJson",
        "mode": "each",
        "options": { "fileName": "=report_orderID_{{ $('If').item.json.orderID }}.json" }
      },
      "id": "c39cf045-1e1c-44aa-a884-879267dd73b0",
      "name": "Convert to File",
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [ -48, 144 ]
    },
    {
      "parameters": {
        "authentication": "webhook",
        "content": "I sent the file using email with the label ID  and wrote the binary file {file name}. My ID: 123",
        "options": {}
      },
      "id": "f807641f-70f2-4050-894a-22a5c8f99b88",
      "name": "Discord",
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [ 400, 144 ],
      "webhookId": "46d90310-2046-4c8d-a2a3-575c718e079f",
      "credentials": {
        "discordWebhookApi": { "id": "D6qu4sPWQkJyyIyZ", "name": "Discord Webhook account" }
      }
    }
  ],
  "connections": {
    "Gmail": { "main": [ [ { "node": "Discord", "type": "main", "index": 0 } ] ] },
    "If": { "main": [ [ { "node": "Convert to File", "type": "main", "index": 0 } ] ] },
    "Convert to File": { "main": [ [ { "node": "Gmail", "type": "main", "index": 0 } ] ] }
  },
  "pinData": {},
  "meta": { "templateCredsSetupCompleted": true, "instanceId": "a612ce3732177191df67c49cdd165a9944332142dec2e0997de31bff5658a964" }
}
              </code></pre>
            </div>
          </details>

          <div class="image-wrapper">
            <img src="../assets/images/materi-21-laporan-penjualan-regional.png" alt="Flow Bagian 2" loading="lazy" />
            <p class="image-caption">Flow Bagian 2: Laporan Regional (Cabang dari Sort Node)</p>
          </div>

          <h3>Kuis Bagian 2</h3>
          <details class="solution-box">
            <summary>‚ùì Ada berapa pesanan di wilayah Americas?</summary>
            <div class="solution-content">
              <p>
                Cek jumlah item di cabang <strong>True</strong> pada node IF.
              </p>
            </div>
          </details>
          <details class="solution-box">
            <summary>
              ‚ùì Berapa item yang dikembalikan node Convert to File?
            </summary>
            <div class="solution-content">
              <p>
                Jumlahnya harus sama dengan jumlah pesanan Americas. Cek output
                node tersebut.
              </p>
            </div>
          </details>

          <h2>Bagian 3: Laporan Total Penjualan (CSV)</h2>
          <p>
            Kita juga ingin memproses <strong>semua pesanan</strong> (dari
            Bagian 1, SETELAH Sort, SEBELUM If), mengelompokkannya menjadi
            batch, dan membuat ringkasan CSV.
          </p>

          <h3>Langkah-langkah:</h3>
          <ol>
            <li>
              <strong>Loop Over Items Node:</strong> Pecah menjadi batch.
              <ul>
                <li>Hubungkan dari <strong>Sort Node</strong>.</li>
                <li>Batch Size: <code>5</code>.</li>
              </ul>
            </li>
            <li>
              <strong>Edit Fields (Set) Node:</strong> Bersihkan data.
              <ul>
                <li>
                  Hanya simpan: <code>customerEmail</code>, <code>region</code>,
                  <code>customerSince</code>, <code>orderPrice</code>.
                </li>
              </ul>
            </li>
            <li>
              <strong>Date & Time Node:</strong> Format tanggal.
              <ul>
                <li>Date: <code>customerSince</code>.</li>
                <li>To Format: <code>MM/DD/YYYY</code>.</li>
              </ul>
            </li>
            <li>
              <strong>Convert to File Node:</strong> Buat CSV.
              <ul>
                <li>Operation: <strong>Convert to CSV</strong>.</li>
                <li>
                  File Name Expression:
                  <code>{{ $runIndex > 0 ? 'file_low_orders' : 'file_high_orders' }}</code>
                </li>
                <li style="font-size: 0.9em; color: var(--text-color-light)">
                  <em>(Logika: Karena data diurutkan besar-ke-kecil, Batch 1
                  (Index 0) adalah "High", batch berikutnya adalah "Low")</em>
                </li>
              </ul>
            </li>
            <li>
              <strong>Discord Node:</strong> Notifikasi.
              <ul>
                <li>
                  Text:
                  <code>I created the spreadsheet {{ $json.fileName }}. My ID: [ID_ANDA]</code>.
                </li>
              </ul>
            </li>
            <li>
              <strong>Loop Back:</strong> Hubungkan output Discord KEMBALI ke
              input Loop Over Items.
            </li>
          </ol>

          <h3>Kode Workflow Bagian 3 (JSON)</h3>
          <p>Salin kode ini. <strong>Hubungkan Input node "Loop Over Items" ke Output node "Sort"</strong> dari Bagian 1.</p>
          <details class="solution-box">
            <summary>üìÑ Klik untuk menyalin JSON Bagian 3</summary>
            <div class="solution-content">
              <pre><code>
{
  "nodes": [
    {
      "parameters": { "batchSize": 5, "options": {} },
      "id": "86ae346b-7b02-4540-94df-eff6b2b6751b",
      "name": "Loop Over Items",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [ -272, 336 ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            { "id": "ce839b80-c50d-48f5-9a24-bb2df6fdd2ff", "name": "customerEmail", "value": "={{ $json.customerEmail }}", "type": "string" },
            { "id": "0c613366-3808-45a2-89cc-b34c7b9f3fb7", "name": "region", "value": "={{ $json.region }}", "type": "string" },
            { "id": "0f19a88c-deb0-4119-8965-06ed62a840b2", "name": "customerSince", "value": "={{ $json.customerSince }}", "type": "string" },
            { "id": "a7e890d6-86af-4839-b5df-d2a4efe923f7", "name": "orderPrice", "value": "={{ $json.orderPrice }}", "type": "number" }
          ]
        },
        "options": {}
      },
      "id": "ab7259aa-b9a9-41c0-a80f-fad31e0ca87d",
      "name": "Edit Fields",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [ -48, 336 ]
    },
    {
      "parameters": {
        "operation": "formatDate",
        "date": "={{ $json.customerSince }}",
        "options": { "includeInputFields": true }
      },
      "id": "5bd9efc1-30f8-4d0b-bdf0-f6afb0b1b917",
      "name": "Date & Time",
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [ 176, 336 ]
    },
    {
      "parameters": {
        "options": { "fileName": "={{$runIndex > 0 ? 'file_low_orders':'file_high_orders'}}" }
      },
      "id": "a3551e0a-db7c-48ac-80c9-9f83b3fd16f4",
      "name": "Convert to File1",
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [ 400, 336 ]
    },
    {
      "parameters": {
        "authentication": "webhook",
        "content": "I created the spreadsheet {file name}. My ID: 123",
        "options": {}
      },
      "id": "a3e0769a-1b24-432b-a108-346278db4e5f",
      "name": "Discord1",
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [ 624, 336 ],
      "credentials": {
        "discordWebhookApi": { "id": "D6qu4sPWQkJyyIyZ", "name": "Discord Webhook account" }
      }
    }
  ],
  "connections": {
    "Loop Over Items": { "main": [ [], [ { "node": "Edit Fields", "type": "main", "index": 0 } ] ] },
    "Edit Fields": { "main": [ [ { "node": "Date & Time", "type": "main", "index": 0 } ] ] },
    "Date & Time": { "main": [ [ { "node": "Convert to File1", "type": "main", "index": 0 } ] ] },
    "Convert to File1": { "main": [ [ { "node": "Discord1", "type": "main", "index": 0 } ] ] },
    "Discord1": { "main": [ [ { "node": "Loop Over Items", "type": "main", "index": 0 } ] ] }
  },
  "pinData": {},
  "meta": { "templateCredsSetupCompleted": true, "instanceId": "a612ce3732177191df67c49cdd165a9944332142dec2e0997de31bff5658a964" }
}
              </code></pre>
            </div>
          </details>

          <div class="image-wrapper">
            <img src="../assets/images/materi-21-laporan-total-penjualan.png" alt="Flow Bagian 3" loading="lazy" />
            <p class="image-caption">Flow Bagian 3: Laporan Total Penjualan (Cabang dari Sort Node)</p>
          </div>

          <h3>Kuis Bagian 3</h3>
          <details class="solution-box">
            <summary>‚ùì Apa format tanggal untuk customer 7?</summary>
            <div class="solution-content">
              <p>
                Cek output Date & Time node. Cari item dengan customerID 7 dan
                baca format tanggal barunya.
              </p>
            </div>
          </details>
          <details class="solution-box">
            <summary>
              ‚ùì Berapa item yang dikembalikan node Convert to File (CSV)?
            </summary>
            <div class="solution-content">
              <p>
                Karena Convert to CSV (tanpa opsi 'Split into items')
                menggabungkan semua item input menjadi SATU file, maka ia
                seharusnya mengembalikan <strong>1 Item</strong> (yang berisi file
                biner tersebut).
              </p>
            </div>
          </details>

          <h2>Kode Workflow Lengkap (Full)</h2>
          <p>
            Ini adalah kode gabungan dari Bagian 1, 2, dan 3 yang sudah saling terhubung (Node Sort terhubung ke IF dan Loop). Gunakan ini jika Anda ingin langsung melihat hasil akhirnya.
          </p>
          <details class="solution-box">
            <summary>üìÑ Klik untuk menyalin JSON FULL (Bagian 1 + 2 + 3)</summary>
            <div class="solution-content">
              <pre><code>
{
  "nodes": [
    { "parameters": {}, "id": "53c8dcdd-83a6-4a3c-ac03-d3ee3d49ec32", "name": "When clicking \"Execute workflow\"", "type": "n8n-nodes-base.manualTrigger", "typeVersion": 1, "position": [-1152, 240] },
    { "parameters": { "url": "https://internal.users.n8n.cloud/webhook/level2-erp", "authentication": "genericCredentialType", "genericAuthType": "httpHeaderAuth", "sendHeaders": true, "headerParameters": { "parameters": [{ "name": "api_key", "value": "j[vKYdY68H(:WFb" }, { "name": "unique_id", "value": "ee139a3c81d52b9da914fd46f413acf2" }] }, "options": {} }, "id": "cbf33d5c-1dfb-41bd-ab5e-dc7779829aba", "name": "HTTP Request", "type": "n8n-nodes-base.httpRequest", "typeVersion": 4.1, "position": [-928, 144], "credentials": { "httpHeaderAuth": { "id": "N248dgARXFPjXLRA", "name": "Header Auth account" } } },
    { "parameters": { "operation": "search", "base": { "__rl": true, "value": "appzgiK89L202rUE3", "mode": "list", "cachedResultName": "Beginner Course", "cachedResultUrl": "https://airtable.com/appzgiK89L202rUE3" }, "table": { "__rl": true, "value": "tblmECBN2BZsUHNjX", "mode": "list", "cachedResultName": "customers", "cachedResultUrl": "https://airtable.com/appzgiK89L202rUE3/tblmECBN2BZsUHNjX" }, "options": {} }, "id": "f975e689-5270-4c01-9197-8941bdd52074", "name": "Airtable", "type": "n8n-nodes-base.airtable", "typeVersion": 2, "position": [-928, 336], "credentials": { "airtableTokenApi": { "id": "xwKF32ZJ0C3iAfpA", "name": "Airtable Personal Access Token account" } } },
    { "parameters": { "mode": "combine", "mergeByFields": { "values": [{ "field1": "customerID", "field2": "customerID" }] }, "options": {} }, "id": "6a528401-b843-4bd4-abc8-761a3da4f444", "name": "Merge", "type": "n8n-nodes-base.merge", "typeVersion": 2.1, "position": [-704, 240] },
    { "parameters": { "sortFieldsUi": { "sortField": [{ "fieldName": "orderPrice", "order": "descending" }] }, "options": {} }, "id": "01cc4cd4-3c1b-40fc-a47e-7fcd7bc2583e", "name": "Sort", "type": "n8n-nodes-base.sort", "typeVersion": 1, "position": [-480, 240] },
    { "parameters": { "sendTo": "naufal97nabila@gmail.com", "subject": "Your TPS Reports", "emailType": "text", "message": "Please find your TPS report attached.", "options": { "attachmentsUi": { "attachmentsBinary": [{}] } } }, "id": "9ca84fac-9c5d-4f08-9579-5cf9398460aa", "name": "Gmail", "type": "n8n-nodes-base.gmail", "typeVersion": 2.1, "position": [176, 144], "credentials": { "gmailOAuth2": { "id": "OLkxnVcb9kIyGtYs", "name": "Gmail account" } } },
    { "parameters": { "conditions": { "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict", "version": 1 }, "conditions": [{ "id": "d3afe65c-7c80-4caa-9d1c-33c62fbc2197", "leftValue": "={{ $json.region }}", "rightValue": "Americas", "operator": { "type": "string", "operation": "equals", "name": "filter.operator.equals" } }], "combinator": "and" }, "options": {} }, "id": "b1021137-70fc-4a48-b04b-482ad56c2200", "name": "If", "type": "n8n-nodes-base.if", "typeVersion": 2, "position": [-272, 144] },
    { "parameters": { "operation": "toJson", "mode": "each", "options": { "fileName": "=report_orderID_{{ $('If').item.json.orderID }}.json" } }, "id": "c39cf045-1e1c-44aa-a884-879267dd73b0", "name": "Convert to File", "type": "n8n-nodes-base.convertToFile", "typeVersion": 1.1, "position": [-48, 144] },
    { "parameters": { "authentication": "webhook", "content": "I sent the file using email with the label ID  and wrote the binary file {file name}. My ID: 123", "options": {} }, "id": "f807641f-70f2-4050-894a-22a5c8f99b88", "name": "Discord", "type": "n8n-nodes-base.discord", "typeVersion": 2, "position": [400, 144], "credentials": { "discordWebhookApi": { "id": "D6qu4sPWQkJyyIyZ", "name": "Discord Webhook account" } } },
    { "parameters": { "batchSize": 5, "options": {} }, "id": "86ae346b-7b02-4540-94df-eff6b2b6751b", "name": "Loop Over Items", "type": "n8n-nodes-base.splitInBatches", "typeVersion": 3, "position": [-272, 336] },
    { "parameters": { "assignments": { "assignments": [{ "id": "ce839b80-c50d-48f5-9a24-bb2df6fdd2ff", "name": "customerEmail", "value": "={{ $json.customerEmail }}", "type": "string" }, { "id": "0c613366-3808-45a2-89cc-b34c7b9f3fb7", "name": "region", "value": "={{ $json.region }}", "type": "string" }, { "id": "0f19a88c-deb0-4119-8965-06ed62a840b2", "name": "customerSince", "value": "={{ $json.customerSince }}", "type": "string" }, { "id": "a7e890d6-86af-4839-b5df-d2a4efe923f7", "name": "orderPrice", "value": "={{ $json.orderPrice }}", "type": "number" }] }, "options": {} }, "id": "ab7259aa-b9a9-41c0-a80f-fad31e0ca87d", "name": "Edit Fields", "type": "n8n-nodes-base.set", "typeVersion": 3.3, "position": [-48, 336] },
    { "parameters": { "operation": "formatDate", "date": "={{ $json.customerSince }}", "options": { "includeInputFields": true } }, "id": "5bd9efc1-30f8-4d0b-bdf0-f6afb0b1b917", "name": "Date & Time", "type": "n8n-nodes-base.dateTime", "typeVersion": 2, "position": [176, 336] },
    { "parameters": { "options": { "fileName": "={{$runIndex > 0 ? 'file_low_orders':'file_high_orders'}}" } }, "id": "a3551e0a-db7c-48ac-80c9-9f83b3fd16f4", "name": "Convert to File1", "type": "n8n-nodes-base.convertToFile", "typeVersion": 1.1, "position": [400, 336] },
    { "parameters": { "authentication": "webhook", "content": "I created the spreadsheet {file name}. My ID: 123", "options": {} }, "id": "a3e0769a-1b24-432b-a108-346278db4e5f", "name": "Discord1", "type": "n8n-nodes-base.discord", "typeVersion": 2, "position": [624, 336], "credentials": { "discordWebhookApi": { "id": "D6qu4sPWQkJyyIyZ", "name": "Discord Webhook account" } } }
  ],
  "connections": {
    "When clicking \"Execute workflow\"": { "main": [[{ "node": "HTTP Request", "type": "main", "index": 0 }, { "node": "Airtable", "type": "main", "index": 0 }]] },
    "HTTP Request": { "main": [[{ "node": "Merge", "type": "main", "index": 0 }]] },
    "Airtable": { "main": [[{ "node": "Merge", "type": "main", "index": 1 }]] },
    "Merge": { "main": [[{ "node": "Sort", "type": "main", "index": 0 }]] },
    "Sort": { "main": [[{ "node": "If", "type": "main", "index": 0 }, { "node": "Loop Over Items", "type": "main", "index": 0 }]] },
    "Gmail": { "main": [[{ "node": "Discord", "type": "main", "index": 0 }]] },
    "If": { "main": [[{ "node": "Convert to File", "type": "main", "index": 0 }]] },
    "Convert to File": { "main": [[{ "node": "Gmail", "type": "main", "index": 0 }]] },
    "Loop Over Items": { "main": [[], [{ "node": "Edit Fields", "type": "main", "index": 0 }]] },
    "Edit Fields": { "main": [[{ "node": "Date & Time", "type": "main", "index": 0 }]] },
    "Date & Time": { "main": [[{ "node": "Convert to File1", "type": "main", "index": 0 }]] },
    "Convert to File1": { "main": [[{ "node": "Discord1", "type": "main", "index": 0 }]] },
    "Discord1": { "main": [[{ "node": "Loop Over Items", "type": "main", "index": 0 }]] }
  },
  "pinData": {},
  "meta": { "templateCredsSetupCompleted": true, "instanceId": "a612ce3732177191df67c49cdd165a9944332142dec2e0997de31bff5658a964" }
}
              </code></pre>
            </div>
          </details>

          <div class="image-wrapper">
            <img src="../assets/images/materi-21-flow-keseluruhan.png" alt="Flow Keseluruhan" loading="lazy" />
            <p class="image-caption">Flow Keseluruhan: Bagian 1, 2, & 3</p>
          </div>

          <h2>Ringkasan</h2>
          <p>
            Selamat! Anda telah berhasil membangun workflow kompleks yang
            melakukan penggabungan data, pemfilteran kondisi, pembuatan file
            (Biner), pengiriman email, dan looping dengan batching. Ini adalah
            inti dari teknik otomatisasi!
          </p>

          <div
            id="page-nav-placeholder"
            data-prev-url="../materi-20/"
            data-prev-title="Materi 20: Workflow 1"
            data-next-url="../materi-22/"
            data-next-title="Materi 22: (Segera Hadir)"
          ></div>

          <div id="support-block-placeholder"></div>
        </article>
      </main>
    </div>
    <script src="../assets/script.js"></script>
  </body>
</html>